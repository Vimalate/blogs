---
title: å¾®å‰ç«¯å®è·µ
date: 2023-02-16
tags:
 - æŠ€å·§
categories: 
 - å…¶ä»–
---

## ç®€å•äº†è§£å¾®å‰ç«¯

>å¾®å‰ç«¯æ˜¯ä¸€ç§å¤šä¸ªå›¢é˜Ÿé€šè¿‡ç‹¬ç«‹å‘å¸ƒåŠŸèƒ½çš„æ–¹å¼æ¥å…±åŒæ„å»ºç°ä»£åŒ– web åº”ç”¨çš„æŠ€æœ¯æ‰‹æ®µåŠæ–¹æ³•ç­–ç•¥ã€‚

å¾®å‰ç«¯å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- æŠ€æœ¯æ ˆæ— å…³ï¼šä¸»æ¡†æ¶ä¸é™åˆ¶æ¥å…¥åº”ç”¨çš„æŠ€æœ¯æ ˆï¼Œå¾®åº”ç”¨å…·å¤‡å®Œå…¨è‡ªä¸»æƒ
- ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼šæ—¢å¯ä»¥ç»„åˆåœ¨ä¸€èµ·è¿è¡Œï¼Œä¹Ÿå¯ä»¥å•ç‹¬è¿è¡Œã€‚
- å¢é‡å‡çº§ï¼šåœ¨é¢å¯¹å„ç§å¤æ‚åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆéš¾å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç³»ç»Ÿåšå…¨é‡çš„æŠ€æœ¯æ ˆå‡çº§æˆ–é‡æ„ï¼Œè€Œå¾®å‰ç«¯æ˜¯ä¸€ç§éå¸¸å¥½çš„å®æ–½æ¸è¿›å¼é‡æ„çš„æ‰‹æ®µå’Œç­–ç•¥
- ç‹¬ç«‹è¿è¡Œæ—¶ï¼šæ¯ä¸ªå¾®åº”ç”¨ä¹‹é—´çŠ¶æ€éš”ç¦»ï¼Œè¿è¡Œæ—¶çŠ¶æ€ä¸å…±äº«

ä»¥ä¸Šä¸º qiankun å®˜ç½‘å¯¹å¾®å‰ç«¯çš„æ¦‚æ‹¬

## å¿«é€Ÿä¸Šæ‰‹

è¿™é‡Œä»¥ vue2.x + qiankun  ä¸ºä¾‹

æˆ‘ä»¬å…ˆç”¨ vue-cliå¿«é€Ÿåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä½œä¸ºä¸»åº”ç”¨ï¼Œè¿™é‡ŒæŠŠä»–å–åä¸º main-app

```sh
vue create main-app
```
ä¸ºè·Ÿå®é™…é¡¹ç›®æ›´æ¥è¿‘ï¼Œæˆ‘ä»¬æš‚æ—¶æ‰‹åŠ¨é€‰æ‹©äº†å®‰è£…è¿™äº›
![](./img/main-app.png)

é¡¹ç›®åˆ›å»ºå®Œåï¼Œæˆ‘ä»¬æŠŠ main-app å¤åˆ¶ä¸€ä»½ä½œä¸ºå­åº”ç”¨ï¼Œæ”¹åä¸º sub-appï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº† main-app ä¸»åº”ç”¨å’Œ sub-app å­åº”ç”¨ã€‚

å¥½çš„ï¼ŒåŸºæœ¬çš„å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆï¼Œæˆ‘ä»¬å¼€å§‹åŸºäºåˆšåˆšåˆ›å»ºçš„ä¸¤ä¸ªé¡¹ç›®æ”¹é€ æˆå¾®å‰ç«¯åº”ç”¨

åœ¨ main-app ä¸­ï¼Œå®‰è£… qiankunï¼š

```sh
yarn add qiankun # æˆ–è€… npm i qiankun -S
```

ç›®å½• src ä¸‹æ–°å»º ```src/qiankun/index.js```

æ³¨å†Œå¾®åº”ç”¨å¹¶å¯åŠ¨ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
import { registerMicroApps, start } from "qiankun";
import store from "@/store";


registerMicroApps([
  {
    name: "sub-vue",
    entry: "http://localhost:7663", // å¾®åº”ç”¨å…¥å£
    container: "#subapp-viewport", // å¾®åº”ç”¨æŒ‚è½½çš„div
    activeRule: "/sub-app/",
    props: {
      // æ­¤å¤„å°†çˆ¶åº”ç”¨çš„ store ä¼ å…¥å­åº”ç”¨
      store
    }
  }
]);

export default start;
```

è¿™é‡Œæˆ‘ä»¬æŠŠå¾®åº”ç”¨çš„è·¯ç”±å‰ç¼€å®šä¹‰ä¸º ```sub-app```

views ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªç»„ä»¶ ```src/views/qiankun/index.vue```,æˆ‘ä»¬æä¾›ä¸€ä¸ª id ä¸º subapp-viewport çš„å®¹å™¨ DOM ä¾›å­åº”ç”¨æŒ‚è½½

```vue
<template>
  <div id="subapp-viewport"></div>
</template>

<script>
import start from "@/qiankun/index";
export default {
  mounted() {
    // å¯åŠ¨å¾®å‰ç«¯
    if (!window.qiankunStarted) {
      window.qiankunStarted = true;
      start();
    }
  }
};
</script>
```

æ‰¾åˆ°è·¯ç”±æ–‡ä»¶å¤¹ï¼Œ```router/index.js```ä¸‹åŠ å…¥å¦‚ä¸‹è·¯ç”±ï¼Œç”¨ä»¥åŒ¹é…å¾®åº”ç”¨ 
```js
{
  path: "/sub-app/*",
  meta: { title: "å­åº”ç”¨" },
  component: () => import("@/views/qiankun/index")
}
```

### å¾®åº”ç”¨

ä¸Šé¢æˆ‘ä»¬å¯¹ä¸»åº”ç”¨çš„æ”¹é€ åŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ä¹‹å‰å¤åˆ¶å‡ºæ¥çš„ sub-app ç¨åŠ æ”¹é€ ï¼Œä½¿å…¶æˆä¸ºå¾®åº”ç”¨


å…ˆæ‰¾åˆ° ```/src/router/index.js``` ,å¯¹è·¯ç”±æ–‡ä»¶ç¨åŠ æ”¹é€ 

åˆ é™¤ 
```js
const router = new VueRouter({
  mode: "history",
  base: process.env.BASE_URL,
  routes
});

export default router;
```

äºæ–‡ä»¶æœ€åæ·»åŠ  
```js
export default routes;
```
æ‰¾åˆ°```main.js```

å°† ```import router from './router'``` ä¿®æ”¹ä¸º ```import routes from './routes'``` ,å¹¶å¢åŠ  ```import VueRouter from "vue-router";```ï¼Œ è¿™é‡Œæˆ‘ä»¬æŠŠä¸»å­åº”ç”¨è·¯ç”±éƒ½è®¾ç½®ä¸º history æ¨¡å¼ã€‚

åˆ é™¤ï¼š
```js
new Vue({
  router,
  store,
  render: h => h(App)
}).$mount("#app");
```
å¢åŠ  

```js
let router = null;
let instance = null;

if (window.__POWERED_BY_QIANKUN__) {
  // eslint-disable-next-line
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__
}

function render(props = {}) {
  const { container } = props;
  router = new VueRouter({
    base: window.__POWERED_BY_QIANKUN__ ? "/sub-vue/" : "/", // æŠ›å‡ºè·¯ç”±åŠ å‰ç¼€
    mode: "history",
    routes
  });

  instance = new Vue({
    router,
    store,
    render: h => h(App)
  }).$mount(container ? container.querySelector("#app") : "#app");
}

if (!window.__POWERED_BY_QIANKUN__) {
  render();
}
export default instance;

export async function bootstrap() {
  console.log("[vue] vue app bootstraped");
}

export async function mount(props) {
  // props åŒ…å«ä¸»åº”ç”¨ä¼ é€’çš„å‚æ•°  ä¹ŸåŒ…æ‹¬ä¸ºå­åº”ç”¨ åˆ›å»ºçš„èŠ‚ç‚¹ä¿¡æ¯
  console.log("[vue] props from main framework", props);
  render(props);
}

export async function unmount() {
  instance.$destroy();
  instance = null;
  router = null;
}
```

æœ€ç»ˆ main.js æ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹

```js
// main.js
import Vue from "vue";
import App from "./App.vue";
import routes from "./router";
import store from "./store";
import VueRouter from "vue-router";

Vue.config.productionTip = false;
// new Vue({
//   router,
//   store,
//   render: h => h(App)
// }).$mount('#app')

// å¾®å‰ç«¯ - å­åº”ç”¨é…ç½®
let router = null;
let instance = null;

if (window.__POWERED_BY_QIANKUN__) {
  // eslint-disable-next-line
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__
}

function render(props = {}) {
  const { container } = props;
  router = new VueRouter({
    base: window.__POWERED_BY_QIANKUN__ ? "/sub-vue/" : "/", // æŠ›å‡ºè·¯ç”±åŠ å‰ç¼€
    mode: "history",
    routes
  });


  instance = new Vue({
    router,
    store,
    render: h => h(App)
  }).$mount(container ? container.querySelector("#app") : "#app");
}

if (!window.__POWERED_BY_QIANKUN__) {
  render();
}
export default instance;

export async function bootstrap() {
  console.log("[vue] vue app bootstraped");
}

export async function mount(props) {
  // props åŒ…å«ä¸»åº”ç”¨ä¼ é€’çš„å‚æ•°  ä¹ŸåŒ…æ‹¬ä¸ºå­åº”ç”¨ åˆ›å»ºçš„èŠ‚ç‚¹ä¿¡æ¯
  render(props);
}

export async function unmount() {
  instance.$destroy();
  instance.$el.innerHTML = '';
  instance = null;
}
```

åœ¨ sub-app ä¸‹æ–°å»º ```vue.config.js``` ,å¢åŠ é…ç½®å¦‚ä¸‹

```js
const { name } = require('./package.json')

module.exports = {
  publicPath: '/', // æ‰“åŒ…ç›¸å¯¹è·¯å¾„
  devServer: {
    port: 7663, // è¿è¡Œç«¯å£å·
    headers: {
      'Access-Control-Allow-Origin': '*' // é˜²æ­¢åŠ è½½æ—¶è·¨åŸŸ
    }
  },
  chainWebpack: config => config.resolve.symlinks(false),
  configureWebpack: {
    output: {
      library: `${name}-[name]`,
      libraryTarget: 'umd', // æŠŠå¾®åº”ç”¨æ‰“åŒ…æˆ umd åº“æ ¼å¼
      jsonpFunction: `webpackJsonp_${name}`
    }
  }
}
```
umd æ ¼å¼åŒ…

UMD(ç»Ÿä¸€æ¨¡å—å®šä¹‰)ï¼šè¿™ç§æ¨¡å—è¯­æ³•ä¼šè‡ªåŠ¨ç›‘æµ‹å¼€å‘äººå‘˜ä½¿ç”¨çš„æ˜¯ Common.js/AMD/import/export ç§çš„å“ªç§æ–¹å¼ï¼Œç„¶åå†é’ˆå¯¹å„è‡ªçš„è¯­æ³•è¿›è¡Œå¯¼å‡ºï¼Œè¿™ç§æ–¹å¼å¯ä»¥å…¼å®¹æ‰€æœ‰å…¶ä»–çš„æ¨¡å—å®šä¹‰æ–¹æ³•ã€‚

![](./img/umd.png)

æœ€åæˆ‘ä»¬åœ¨å¾®åº”ç”¨æ–°å»ºä¸€ä¸ªæµ‹è¯•é¡µé¢ä»¥ä¾›åµŒå…¥ä¸»åº”ç”¨ï¼Œè·¯ç”±æš‚ä¸”å–å ```/test```

```vue
// views/sub-app/index.vue
<template>
  <div class="sub-app">
    æˆ‘æ˜¯å­åº”ç”¨
  </div>
</template>

<style lang="scss" scoped>
.sub-app {
  cursor: pointer;
  background-color: aqua;
}
</style>
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å¯¹ä¸»åº”ç”¨å’Œå¾®åº”ç”¨çš„æ”¹é€ åŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä¸»åº”ç”¨çš„ ```app.vue```æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œä½¿å…¶ç‚¹å‡»çš„æ—¶å€™æ·»åŠ äº‹ä»¶ ```this.$router.push('/sub-vue/test')``` è·³è½¬è‡³å­åº”ç”¨

![](./img/qiankun-main.png)

å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®å,å¯ä»¥çœ‹åˆ°ï¼Œå¾®åº”ç”¨åµŒå…¥æˆåŠŸ

![](./img/qiankun-sub.png)


è¿™é‡Œæˆ‘ä»¬ä¸»å­åº”ç”¨éƒ½é‡‡ç”¨äº†åŒä¸€å¥—æŠ€æœ¯æ ˆï¼Œæ˜¯å› ä¸ºåœ¨å…¬å¸é¡¹ç›®ä¸­æˆ‘ä»¬ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œç›¸åŒçš„æŠ€æœ¯æ ˆå¯ä»¥å®ç°å…¬å…±ä¾èµ–åº“ã€UIåº“ç­‰æŠ½ç¦»ï¼Œå‡å°‘èµ„æºå¼€é”€ï¼Œæå‡åŠ è½½é€Ÿåº¦ï¼Œæœ€é‡è¦çš„æ˜¯ï¼šâ€œå‡å°‘å†²çªçš„æœ€å¥½æ–¹å¼å°±æ˜¯ç»Ÿä¸€â€ï¼Œé€šè¿‡çº¦æŸæŠ€æœ¯æ ˆå¯ä»¥å°½å¯èƒ½çš„å‡å°‘é¡¹ç›®ä¹‹é—´çš„å†²çªï¼Œå‡å°‘å·¥ä½œé‡ä¸ç»´æŠ¤æˆæœ¬ã€‚

## å¾®å‰ç«¯å¸¸è§é—®é¢˜


### ä¸»å­åº”ç”¨æ ·å¼ç›¸äº’å½±å“

å„ä¸ªåº”ç”¨æ ·å¼éš”ç¦»
è¿™ä¸ªé—®é¢˜ä¹¾å¤æ¡†æ¶åšäº†ä¸€å®šçš„å¤„ç†ï¼Œåœ¨è¿è¡Œæ—¶æœ‰ä¸€ä¸ªsandboxçš„å‚æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ²™ç®±å¯ä»¥ç¡®ä¿å•å®ä¾‹åœºæ™¯å­åº”ç”¨ä¹‹é—´çš„æ ·å¼éš”ç¦»ï¼Œä½†æ˜¯æ— æ³•ç¡®ä¿ä¸»åº”ç”¨è·Ÿå­åº”ç”¨ã€æˆ–è€…å¤šå®ä¾‹åœºæ™¯çš„å­åº”ç”¨æ ·å¼éš”ç¦»ã€‚å¦‚æœè¦è§£å†³ä¸»åº”ç”¨å’Œå­åº”ç”¨çš„æ ·å¼é—®é¢˜ï¼Œç›®å‰æœ‰2ç§æ–¹å¼ï¼š

åœ¨ä¹¾å¤ç§é…ç½® { strictStyleIsolation: true } æ—¶è¡¨ç¤ºå¼€å¯ä¸¥æ ¼çš„æ ·å¼éš”ç¦»æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ qiankun ä¼šä¸ºæ¯ä¸ªå¾®åº”ç”¨çš„å®¹å™¨åŒ…è£¹ä¸Šä¸€ä¸ª shadow dom èŠ‚ç‚¹ï¼Œä»è€Œç¡®ä¿å¾®åº”ç”¨çš„æ ·å¼ä¸ä¼šå¯¹å…¨å±€é€ æˆå½±å“ã€‚ä½†æ˜¯åŸºäº ShadowDOM çš„ä¸¥æ ¼æ ·å¼éš”ç¦»å¹¶ä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ— è„‘ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½éœ€è¦æ¥å…¥åº”ç”¨åšä¸€äº›é€‚é…åæ‰èƒ½æ­£å¸¸åœ¨ ShadowDOM ä¸­è¿è¡Œèµ·æ¥ï¼Œè¿™ä¸ªåœ¨ qiankun çš„ issue é‡Œé¢æœ‰ä¸€äº›è®¨è®ºå’Œä½¿ç”¨ç»éªŒã€‚
äººä¸ºç”¨ css å‰ç¼€æ¥éš”ç¦»å¼€ä¸»åº”ç”¨å’Œå­åº”ç”¨ï¼Œåœ¨ç»„ä»¶å±‚é¢ç”¨ css scopedè¿›è¡Œç»„ä»¶å±‚é¢çš„æ ·å¼åŒºåˆ†ï¼Œåœ¨ cssæ¡†æ¶å±‚é¢å¯ä»¥ç»™cssç»„ä»¶åº“åŠ ä¸Šä¸åŒçš„å‰ç¼€ï¼Œæ¯”å¦‚æ–‡æ¡£ä¸­çš„ antd ä¾‹å­ï¼š
é…ç½® webpack ä¿®æ”¹ less å˜é‡
```js
{
  loader: 'less-loader',
+ options: {
+   modifyVars: {
+     '@ant-prefix': 'yourPrefix',
+   },
+   javascriptEnabled: true,
+ },
}
```
b. é…ç½® antd ConfigProvider

```js
import { ConfigProvider } from 'antd';
   
export const MyApp = () => (
  <ConfigProvider prefixCls="yourPrefix">
    <App />
  </ConfigProvider>
);
```

## åº”ç”¨é—´é€šä¿¡

- 1ã€localStorage/sessionStorage
- 2ã€é€šè¿‡è·¯ç”±å‚æ•°å…±äº«
- 3ã€å®˜æ–¹æä¾›çš„ props
- 4ã€å®˜æ–¹æä¾›çš„ actions
- 5ã€ä½¿ç”¨vuexæˆ–reduxç®¡ç†çŠ¶æ€ï¼Œé€šè¿‡sharedåˆ†äº«

å…·ä½“å®ç°å‚è€ƒè¿™ç¯‡æ–‡ç«  [qiankunçš„äº”ç§é€šä¿¡æ–¹å¼](https://blog.csdn.net/weixin_43972437/article/details/128154083)

## qiankun å®ç° keep-alive éœ€æ±‚

å­é¡¹ç›® keep-alive å…¶å®å°±æ˜¯æƒ³åœ¨å­é¡¹ç›®åˆ‡æ¢æ—¶ä¸å¸è½½æ‰ï¼Œä»…ä»…æ˜¯æ ·å¼ä¸Šçš„éšè—ï¼ˆdisplay: noneï¼‰ï¼Œè¿™æ ·ä¸‹æ¬¡æ‰“å¼€å°±ä¼šæ›´å¿«ã€‚

ä½†æ˜¯ keep-alive éœ€è¦è°¨æ…ä½¿ç”¨ï¼ŒåŒæ—¶åŠ è½½å¹¶è¿è¡Œå¤šä¸ªå­é¡¹ç›®ï¼Œè¿™å°†ä¼šå¢åŠ  js/css æ±¡æŸ“çš„é£é™©ã€‚

äº§å“é‚£è¾¹å…¶å®å½“æ—¶æ˜¯æœ‰æå‡ºè¿™ä¸ªéœ€æ±‚çš„ï¼Œå½“æ—¶ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„æ˜¯å€ŸåŠ© qiankun çš„ loadMicroApp å‡½æ•°æ¥æ‰‹åŠ¨åŠ è½½å’Œå¸è½½å­åº”ç”¨ã€‚ä½†æ˜¯å…¬å¸çš„é¡¹ç›®ä¸»åº”ç”¨åµŒå…¥äº†åå‡ ä¸ªå­åº”ç”¨ï¼Œæƒ³åˆ°éœ€è¦ä¸€ä¸ªä¸ªå¤„ç†ï¼Œä»¥åŠæ‰‹åŠ¨åŠ è½½å’Œå¸è½½å­åº”ç”¨æ‰€å¯èƒ½å¸¦æ¥çš„ä¸€äº›è¾¹ç•Œé—®é¢˜å¤„ç†ï¼Œåé¢ç›´æ¥è¯´è¿™ä¸ªéœ€æ±‚ä¸å¥½å®ç°ã€‚ä¹‹åä¹Ÿå°±æš‚æ—¶æç½®äº†


å…·ä½“è§£å†³æ–¹æ¡ˆå¯ä»¥çœ‹ [qiankun issues](https://github.com/umijs/qiankun/issues/361) é‡Œæ‰€ç»™å‡ºçš„

### è·¯ç”±è·³è½¬é—®é¢˜

åœ¨å­åº”ç”¨ä¸­æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡ ```<router-link>``` æˆ–è€…ç”¨ ```router.push/router.replace``` ç›´æ¥è·³è½¬çš„ï¼Œå› ä¸ºè¿™ä¸ª router æ˜¯å­é¡¹ç›®çš„è·¯ç”±ï¼Œæ‰€æœ‰çš„è·³è½¬éƒ½ä¼šåŸºäºå­é¡¹ç›®çš„ base ã€‚å½“ç„¶äº†å†™ ```<a>``` é“¾æ¥å¯ä»¥è·³è½¬è¿‡å»ï¼Œä½†æ˜¯ä¼šåˆ·æ–°é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒå¹¶ä¸å¥½ã€‚

- å°†ä¸»åº”ç”¨çš„è·¯ç”±å®ä¾‹é€šè¿‡ props ä¼ ç»™å¾®åº”ç”¨ï¼Œå¾®åº”ç”¨è¿™ä¸ªè·¯ç”±å®ä¾‹è·³è½¬ã€‚
- history æ¨¡å¼æ—¶ï¼Œé€šè¿‡ history.pushState() æ–¹å¼è·³è½¬

è¿™é‡Œæˆ‘æŠŠä»–å°è£…ä¸ºäº†ä¸€ä¸ªå¸¸ç”¨æ–¹æ³•

```js
/**
 * å¾®å‰ç«¯å­åº”ç”¨è·¯ç”±è·³è½¬
 * @param {String} url è·¯ç”±
 * @param {Object} mainRouter ä¸»åº”ç”¨è·¯ç”±å®ä¾‹
 * @param {*} params çŠ¶æ€å¯¹è±¡ï¼šä¼ ç»™ç›®æ ‡è·¯ç”±çš„ä¿¡æ¯,å¯ä¸ºç©º
 */

const qiankunJump = (url, mainRouter, params) => {
  if (mainRouter) {
    // ä½¿ç”¨ä¸»åº”ç”¨è·¯ç”±å®ä¾‹è·³è½¬
    mainRouter.push({ path: url, query: params })
    return
  }
  // æœªä¼ é€’ä¸»åº”ç”¨è·¯ç”±å®ä¾‹ï¼Œä¼ ç»Ÿæ–¹å¼è·³è½¬
  let searchParams = '?'
  let targetUrl = url
  if (typeOf(params) === 'object' && Object.keys(params).length) {
    Object.keys(params).forEach(item => {
      searchParams += `${item}=${params[item]}&`
    })
    targetUrl = targetUrl + searchParams.slice(0, searchParams.length - 1)
  }
  window.history.pushState(null, '', targetUrl)
}
```

### qiankun+vue é€‚é…vue-pdfè¸©å‘

æ‰¾åˆ°vue-pdfçš„ä¾èµ–åŒ…ä¸‹çš„vuePdfNoSss.vue

```vue
//æ‰¾åˆ°vue-pdfçš„ä¾èµ–åŒ…ä¸‹çš„vuePdfNoSss.vue
<style src="./annotationLayer.css"></style>
<script>
	import componentFactory from './componentFactory.js'
	if ( process.env.VUE_ENV !== 'server' ) {
		var pdfjsWrapper = require('./pdfjsWrapper.js').default;
		var PDFJS = require('pdfjs-dist/es5/build/pdf.js');
		if ( typeof window !== 'undefined' && 'Worker' in window && navigator.appVersion.indexOf('MSIE 10') === -1 ) {
      // æ³¨é‡ŠåŸæœ¬çš„å¼•å…¥æ–¹æ³•
			// var PdfjsWorker = require('worker-loader!pdfjs-dist/es5/build/pdf.worker.js');
			  var PdfjsWorker=require('pdfjs-dist/es5/build/pdf.worker.js');
			PDFJS.GlobalWorkerOptions.workerPort = new PdfjsWorker();
		}
		var component = componentFactory(pdfjsWrapper(PDFJS));
	} else {
		var component = componentFactory({});
	}
	export default component;
</script>
```

ä¿®æ”¹é¡¹ç›®çš„é…ç½®æ–‡ä»¶vue.config.js

```js
chainWebpack: (config) => {
  config.module
    .rule('worker')
    .test(/\.worker\.js$/)
    .use('worker-loader').loader('worker-loader')
    .options({
      inline: true,
      fallback: false
    }).end();
}
```

### ä¸»é¡¹ç›®å’Œå­é¡¹ç›®éƒ¨ç½²åˆ°ä¸€èµ·ï¼Œå­é¡¹ç›®éƒ¨ç½²åˆ°äºŒçº§ç›®å½•(ä¸å ç”¨è¿™ä¹ˆå¤šç«¯å£)

å› ä¸ºå®¢æˆ·æ–¹çš„è¦æ±‚ï¼Œå¯èƒ½æœ‰æ—¶å€™ä¸å…è®¸æœåŠ¡å™¨å¼€å¤ªå¤šçš„ç«¯å£ï¼Œå› æ­¤éœ€è¦æŠŠä¸»åº”ç”¨å’Œå¾®åº”ç”¨éƒ¨ç½²åˆ°ä¸€èµ·ï¼Œå…¬ç”¨ä¸€ä¸ªç«¯å£ã€‚

[ä¸»é¡¹ç›®å’Œå­é¡¹ç›®éƒ¨ç½²åˆ°ä¸€èµ·ï¼Œå­é¡¹ç›®éƒ¨ç½²åˆ°äºŒçº§ç›®å½•](https://github.com/umijs/qiankun/issues/400#issuecomment-676947927)

### qiankunåœ¨å­åº”ç”¨ä¸­å¼•å…¥ç™¾åº¦åœ°å›¾æ—¶æŠ¥é”™è§£å†³

ä¿®æ”¹ä¸»åº”ç”¨ start æ–¹æ³•

```js
// å¯åŠ¨å¾®å‰ç«¯
if (!window.qiankunStarted) {
  window.qiankunStarted = true
  start({
    singular: false,
    excludeAssetFilter: (assetUrl) => {
      // è¿‡æ»¤baidu
      const wihiteWords = ['baidu']
      if (wihiteWords.includes(assetUrl)) {
        return true
      }
      return wihiteWords.some(w => {
        return assetUrl.includes(w)
      })
    }
  })
}
```

å…¶ä»–ä¸€äº›å¸¸è§é—®é¢˜å¯è§äº [qiankunå®˜ç½‘](https://qiankun.umijs.org/zh/faq)

æ€»çš„æ¥è¯´ï¼Œå¾®å‰ç«¯ç¡®å®è§£å†³äº†ä¸€äº›é¡¹ç›®ä¸­çš„ç—›ç‚¹ï¼Œä½†æ˜¯åˆ‡è®°å¾®å‰ç«¯ä¸æ˜¯é“¶å¼¹ï¼Œè€æ—§é¡¹ç›®å¸¦æ¥çš„è¿ç§»æˆæœ¬ï¼Œä¸åŒæŠ€æœ¯æ ˆçš„å…¼å®¹ä¸è¾¹ç•Œé—®é¢˜å¤„ç†ï¼Œå› ä¸ºæ²¡æœ‰è¿«åˆ‡çš„éœ€æ±‚è¦æ¥å…¥å¾®å‰ç«¯ï¼Œåªä¼šå¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œiframe å…¶å®å°±å¾ˆå¤Ÿç”¨äº†ã€‚

å‚è€ƒï¼š
[ä¸‡å­—é•¿æ–‡-è½åœ°å¾®å‰ç«¯ qiankun ç†è®ºä¸å®è·µæŒ‡åŒ—](https://juejin.cn/post/7069566144750813197)

[qiankun å¾®å‰ç«¯å®è·µæ€»ç»“](https://juejin.cn/post/6856569463950639117)


## å¾€æœŸå›é¡¾
[vue3 æ­£å¼å‘å¸ƒä¸¤å¹´åï¼Œæˆ‘æ‰å¼€å§‹å­¦ â€” vue3+setup+ts ğŸ”¥](https://juejin.cn/post/7158331832512020511)
<br>
[2022å¹´äº†ï¼Œæˆ‘æ‰å¼€å§‹å­¦ typescript ï¼Œæ™šå—ï¼Ÿï¼ˆ7.5kå­—æ€»ç»“ï¼‰](https://juejin.cn/post/7124117404187099172)
<br>
[å½“æˆ‘ä»¬å¯¹ç»„ä»¶äºŒæ¬¡å°è£…æ—¶æˆ‘ä»¬åœ¨å°è£…ä»€ä¹ˆ](https://juejin.cn/post/7127925414885851144)
<br>
[vue é¡¹ç›®å¼€å‘ï¼Œæˆ‘é‡åˆ°äº†è¿™äº›é—®é¢˜](https://juejin.cn/post/7119018849353072677)
<br>
[å…³äºé¦–å±ä¼˜åŒ–ï¼Œæˆ‘åšäº†å“ªäº›](https://juejin.cn/post/7117515006714839047)

